{"version":3,"file":"main.js","mappings":"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","sources":["webpack://pm/./apps/pm-backend/src/config/database.js","webpack://pm/./apps/pm-backend/src/controllers/admin.js","webpack://pm/./apps/pm-backend/src/controllers/conversations.js","webpack://pm/./apps/pm-backend/src/controllers/interests.js","webpack://pm/./apps/pm-backend/src/controllers/recommendations.js","webpack://pm/./apps/pm-backend/src/controllers/search.js","webpack://pm/./apps/pm-backend/src/controllers/shortlist.js","webpack://pm/./apps/pm-backend/src/controllers/users.js","webpack://pm/./apps/pm-backend/src/middleware/async.js","webpack://pm/./apps/pm-backend/src/middleware/error.js","webpack://pm/./apps/pm-backend/src/models/Users.js","webpack://pm/./apps/pm-backend/src/routes/admin.js","webpack://pm/./apps/pm-backend/src/routes/conversations.js","webpack://pm/./apps/pm-backend/src/routes/interests.js","webpack://pm/./apps/pm-backend/src/routes/recommendations.js","webpack://pm/./apps/pm-backend/src/routes/search.js","webpack://pm/./apps/pm-backend/src/routes/shortlist.js","webpack://pm/./apps/pm-backend/src/routes/users.js","webpack://pm/./apps/pm-backend/src/utilities/errorResponse.js","webpack://pm/external commonjs \"@okta/okta-sdk-nodejs\"","webpack://pm/external commonjs \"body-parser\"","webpack://pm/external commonjs \"cors\"","webpack://pm/external commonjs \"express\"","webpack://pm/external commonjs \"mongoose\"","webpack://pm/external commonjs \"tslib\"","webpack://pm/webpack/bootstrap","webpack://pm/./apps/pm-backend/src/main.js"],"sourcesContent":["const mongoose = require('mongoose');\r\n\r\nconst dbConnection = async () => {\r\n  console.log('Connecting to mongoDB...');\r\n  const connection = await mongoose.connect(process.env.MONGO_URI, {\r\n    useNewUrlParser: true,\r\n    useUnifiedTopology: true,\r\n  });\r\n  console.log(`MongoDB connection successful !`);\r\n};\r\n\r\nmodule.exports = dbConnection;\r\n","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\nconst okta = require('@okta/okta-sdk-nodejs');\r\n\r\n\r\n\r\n//getting all users profiles\r\nexports.getAllUsersProfiles = asyncHandler(async (req, res, next) => {\r\n\r\n    const allUsers = await User.find();\r\n  \r\n    res.status(200).json({ user: allUsers });\r\n})","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\nconst mongoose = require('mongoose');\r\n\r\n// @desc   Send a New Message\r\n// @route  POST /api/v1/conversations?receiver=\"receiverID\"&sender=\"senderID\"\r\n// @access Private\r\n// In One go...the message sent MUST be in \"conversations\" array of both user1 and user2.\r\n// Otherwise, consider that attempt to send message as failure. So a MongoDB/Mongoose Transaction must be used.\r\nexports.sendMessage = asyncHandler(async (req, res, next) => {\r\n  const oktaUserId1 = req.query.sender;\r\n  const oktaUserId2 = req.query.receiver;\r\n  // I want the message object to have SAME _id in both users\r\n  // This will help me to enable read receipts\r\n\r\n  const message = {\r\n    _id: new mongoose.Types.ObjectId(),\r\n    message: req.body.message,\r\n    messageSenderId: oktaUserId1,\r\n    messageReceiverId: oktaUserId2,\r\n    isRead: false,\r\n  };\r\n\r\n  const session = await User.startSession();\r\n\r\n  try {\r\n    session.startTransaction();\r\n\r\n    const user1 = await User.find({ oktaUserId: oktaUserId1 })[0];\r\n    const user2 = await User.find({ oktaUserId: oktaUserId2 })[0];\r\n\r\n    /**=============================================================== */\r\n    // User1 wants to send Message to User2\r\n\r\n    // NOTE: Messages are stored in an interest object's conversations property(array).\r\n\r\n    // STEP 1\r\n    // Determine if it is User1 who first sent the interest.\r\n    const didUser1SendInterestToUser2 = user1.interestsSent.some(\r\n      (interest) => String(interest.interestReceiverId) === oktaUserId2\r\n    );\r\n    // Determine if it is User1 who first received the interest.\r\n    const didUser1ReceiveInterestFromUser2 = user1.interestsReceived.some((interest) =>\r\n      String(interest.interestSenderId === oktaUserId2)\r\n    );\r\n    // If User1 is the first sender, then interest object will be in interestsSent Array\r\n    // If User1 is the first receiver, then interest object will be in interestsReceived Array\r\n    // Based on the location of interest object, update its conversations array...\r\n    if (didUser1SendInterestToUser2) {\r\n      // if user1 is the interest sender. So update interest object in interestsSent array of user 1\r\n      user1.interestsSent = user1.interestsSent.map((interest) => {\r\n        if (String(interest.interestReceiverId) === oktaUserId2) {\r\n          interest.conversations.push(message);\r\n        }\r\n        return interest;\r\n      });\r\n      // if user1 is the interest sender, then user2 is interest receiver.\r\n      // so interest object will be in user2's interestsReceived array\r\n      user2.interestsReceived = user2.interestsReceived.map((interest) => {\r\n        if (String(interest.interestSenderId) === oktaUserId1) {\r\n          interest.conversations.push(message);\r\n        }\r\n        return interest;\r\n      });\r\n    } else if (didUser1ReceiveInterestFromUser2) {\r\n      // user1 is interest receiver. Hence, update interest object in interestsReceived array of user1\r\n      user1.interestsReceived = user1.interestsReceived.map((interest) => {\r\n        if (String(interest.interestSenderId) === oktaUserId2) {\r\n          interest.conversations.push(message);\r\n        }\r\n        return interest;\r\n      });\r\n      // if user1 is the interest receiver.\r\n      // then user2 is the interest sender. So update interest object in interestsSent array of user2\r\n      user2.interestsSent = user2.interestsSent.map((interest) => {\r\n        if (String(interest.interestReceiverId) === oktaUserId1) {\r\n          interest.conversations.push(message);\r\n        }\r\n        return interest;\r\n      });\r\n    } else {\r\n      // If interest object is not present in both, then message cant be sent.\r\n      throw `Permission denied.`;\r\n    }\r\n    /**=============================================================== */\r\n    await user1.save();\r\n    await user2.save();\r\n\r\n    await session.commitTransaction();\r\n    session.endSession();\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Message sent !',\r\n    });\r\n  } catch (error) {\r\n    // If an error occurred, abort the whole transaction and\r\n    // undo any changes that might have happened\r\n    // console.log(error);\r\n    await session.abortTransaction();\r\n    session.endSession();\r\n    return next(new CustomErrorResponse('Message not sent! Please try later', 500));\r\n  }\r\n});\r\n\r\n// @desc   Mark all messages between two users as \"Read\"\r\n// @route  PUT /api/v1/conversations?user1=\"oktaUserId1\"&user2=\"oktaUserId2\"\r\n// @access Private\r\nexports.markMessagesAsRead = asyncHandler(async (req, res, next) => {\r\n  const oktaUserId1 = req.query.user1;\r\n  const oktaUserId2 = req.query.user2;\r\n\r\n  const session = await User.startSession();\r\n  try {\r\n    session.startTransaction();\r\n\r\n    const user1 = await User.findById(oktaUserId1);\r\n    const user2 = await User.findById(oktaUserId2);\r\n\r\n    // STEP 1\r\n    // Determine if it is User1 who first sent the interest.\r\n    const didUser1SendInterestToUser2 = user1.interestsSent.some(\r\n      (interest) => String(interest.interestReceiverId) === oktaUserId2\r\n    );\r\n    // Determine if it is User1 who first received the interest.\r\n    const didUser1ReceiveInterestFromUser2 = user1.interestsReceived.some((interest) =>\r\n      String(interest.interestSenderId === oktaUserId2)\r\n    );\r\n\r\n    if (didUser1SendInterestToUser2) {\r\n      // if User1 sent interest to User2, then...\r\n      // 1. Identify the interest object specific to user2 in interestsSent array of user1\r\n      // 2. Then update the conversations array of that object, mark all messages as read.\r\n      // 3. Also, find the interest object specific to user 1 in interestsReceived array of user2\r\n      // 4. Update conversations array of that object by marking all messages as read.\r\n      user1.interestsSent = user1.interestsSent.map((interest) => {\r\n        if (String(interest.interestReceiverId) === user2.id) {\r\n          // marking all unread messages as read.\r\n          interest.conversations = interest.conversations.map((message) => {\r\n            if (!message.isRead) {\r\n              message.isRead = true;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return interest;\r\n      });\r\n\r\n      user2.interestsReceived = user2.interestsReceived.map((interest) => {\r\n        if (String(interest.interestSenderId) === user1.id) {\r\n          // marking all messages as read.\r\n          interest.conversations = interest.conversations.map((message) => {\r\n            if (!message.isRead) {\r\n              message.isRead = true;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return interest;\r\n      });\r\n    } else if (didUser1ReceiveInterestFromUser2) {\r\n      // if User1 sent received interest from User2, then...\r\n      // 1. Identify the interest object specific to user2 in interestsReceived array of user1\r\n      // 2. Then update the conversations array of that object, mark all messages as read.\r\n      // 3. Also, find the interest object specific to user 1 in interestsSent array of user2\r\n      // 4. Update conversations array of that object by marking all messages as read.\r\n      user1.interestsReceived = user1.interestsReceived.map((interest) => {\r\n        if (String(interest.interestSenderId) === user2.id) {\r\n          // marking all messages as read.\r\n          interest.conversations = interest.conversations.map((message) => {\r\n            if (!message.isRead) {\r\n              message.isRead = true;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return interest;\r\n      });\r\n\r\n      user2.interestsSent = user2.interestsSent.map((interest) => {\r\n        if (String(interest.interestReceiverId) === user1.id) {\r\n          interest.conversations = interest.conversations.map((message) => {\r\n            // marking all messages as read.\r\n            if (!message.isRead) {\r\n              message.isRead = true;\r\n            }\r\n            return message;\r\n          });\r\n        }\r\n        return interest;\r\n      });\r\n    } else {\r\n      throw 'Permission denied.';\r\n    }\r\n\r\n    await user1.save();\r\n    await user2.save();\r\n  } catch (error) {\r\n    // If an error occurred, abort the whole transaction and\r\n    // undo any changes that might have happened\r\n    // console.log(error);\r\n    await session.abortTransaction();\r\n    session.endSession();\r\n    return next(new CustomErrorResponse('Error! Please try later', 500));\r\n  }\r\n\r\n  res.status(200).json({\r\n    success: true,\r\n    message: 'Messages marked as read !',\r\n  });\r\n});\r\n\r\n// @desc   Get all messages between two users as \"Read\"\r\n// @route  GET /api/v1/conversations/:userId\r\n// @access Private\r\n\r\nexports.getMessages = asyncHandler(async (req, res, next) => {\r\n  const userId = req.params.userId;\r\n  const user = await User.findById(userId);\r\n  if (!user) {\r\n    return next(new CustomErrorResponse(`User not found!`, 404));\r\n  }\r\n  res.status(200).json({\r\n    success: true,\r\n    message: 'Data Retrieved Successfull !',\r\n    interestsReceived: [...user.interestsReceived],\r\n    interestsSent: [...user.interestsSent],\r\n  });\r\n});\r\n","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\nconst mongoose = require('mongoose');\r\n\r\n// @desc   Send a New Interest\r\n// @route  POST /api/v1/interests?sender=oktaUserId1&receiver=oktaUserId2\r\n// @access Private\r\n\r\n// In One go...the interest sent MUST be in \"interestsSent\" array of Sender and \"interestsReceived\" array of Receiver.\r\n// Otherwise, consider that attempt to send interest as failure. So a MongoDB/Mongoose Transaction must be used.\r\n\r\nexports.sendInterest = asyncHandler(async (req, res, next) => {\r\n  const oktaUserId1 = req.query.sender;\r\n  const oktaUserId2 = req.query.receiver;\r\n  const session = await User.startSession();\r\n\r\n  try {\r\n    session.startTransaction();\r\n\r\n    const user1 = await User.find({ oktaUserId: oktaUserId1 })[0];\r\n    const user2 = await User.find({ oktaUserId: oktaUserId2 })[0];\r\n\r\n    /**=============================================================== */\r\n    // User1 wants to send Interest to User2\r\n\r\n    // NOTE: Interests are stored as objects in interestsSender array of Sender(User1)\r\n    // & also in interestsReceived array of Receiver(User2).\r\n\r\n    // Step 1: Determine if User1 already send or received interest to/from User 2 ?\r\n    // If Yes, then throw error that You've already sent/received interest to User 2\r\n\r\n    // Checking interestsSent and interestsReceived array of User1\r\n    const didUser1AlreadySendInterestToUser2 = user1.interestsSent.some(\r\n      (interest) => String(interest.interestReceiverId) === oktaUserId2\r\n    );\r\n\r\n    if (didUser1AlreadySendInterestToUser2) {\r\n      await session.abortTransaction();\r\n      session.endSession();\r\n      return next(new CustomErrorResponse(`Interest already sent to ${user2.name}. Please wait for response.`, 400));\r\n    }\r\n\r\n    const didUser1AlreadyReceiveInterestFromUser2 = user1.interestsReceived.some(\r\n      (interest) => String(interest.interestSenderId) === oktaUserId2\r\n    );\r\n\r\n    if (didUser1AlreadyReceiveInterestFromUser2) {\r\n      await session.abortTransaction();\r\n      session.endSession();\r\n      return next(new CustomErrorResponse(`Interest already received from ${user2.name}. Please respond to it.`, 400));\r\n    }\r\n\r\n    // If Not sent Interest before, then...\r\n    // put the interest object in interestsSent array of User1\r\n    user1.interestsSent.push({\r\n      conversations: [],\r\n      interestSenderAge: user1.age,\r\n      interestSenderId: user1.id,\r\n      interestSenderImage: user1.images[0] || 'link to placeholder image',\r\n      interestSenderName: user1.name,\r\n      interestReceiverAge: user2.age,\r\n      interestReceiverId: user2.id,\r\n      interestReceiverImage: user2.images[0] || 'link to placeholder image',\r\n      interestReceiverName: user2.name,\r\n      isAccepted: false,\r\n      isRejected: false,\r\n    });\r\n\r\n    // Also...\r\n    // Put the same interest object in interestsReceived array of User2\r\n    user2.interestsReceived.push({\r\n      conversations: [],\r\n      interestSenderAge: user1.age,\r\n      interestSenderId: user1.id,\r\n      interestSenderImage: user1.images[0] || 'link to placeholder image',\r\n      interestSenderName: user1.name,\r\n      interestReceiverAge: user2.age,\r\n      interestReceiverId: user2.id,\r\n      interestReceiverImage: user2.images[0] || 'link to placeholder image',\r\n      interestReceiverName: user2.name,\r\n      isAccepted: false,\r\n      isRejected: false,\r\n    });\r\n\r\n    /**=============================================================== */\r\n    await user1.save();\r\n    await user2.save();\r\n\r\n    await session.commitTransaction();\r\n    session.endSession();\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Interest sent!',\r\n    });\r\n  } catch (error) {\r\n    // If an error occurred, abort the whole transaction and\r\n    // undo any changes that might have happened\r\n    // console.log(error);\r\n    await session.abortTransaction();\r\n    session.endSession();\r\n    return next(new CustomErrorResponse('Interest not sent. Please try later!', 500));\r\n  }\r\n});\r\n\r\n// @desc   Accept an Interest\r\n// @route  PUT /api/v1/interests/accept?sender=oktaUserId1&receiver=oktaUserId2\r\n// @access Private\r\n\r\n// In One go... isAccepted property in interest object must be updated to \"true\" for\r\n// both sender and receiver.\r\n// User1 is interest Sender. Interest object will be in interestsSent array of User 1\r\n// User2 is interest Receiver. Interest object will be in interestsReceived array of User 2\r\n// User2 can accept interest. Because User2 \"received\" the interest.\r\n// When he does that... update isAccepted to \"true\" for both\r\nexports.acceptInterest = asyncHandler(async (req, res, next) => {\r\n  const oktaUserId1 = req.query.sender;\r\n  const oktaUserId2 = req.query.receiver;\r\n  const session = await User.startSession();\r\n\r\n  try {\r\n    session.startTransaction();\r\n\r\n    const user1 = await User.find({ oktaUserId: oktaUserId1 })[0];\r\n    const user2 = await User.find({ oktaUserId: oktaUserId2 })[0];\r\n    /**=============================================================== */\r\n\r\n    user2.interestsReceived = user2.interestsReceived.map((interest) => {\r\n      // First identify the interest object which must be updated.\r\n      if (String(interest.interestSenderId) === user1.id) {\r\n        interest.isAccepted = true;\r\n      }\r\n      return interest;\r\n    });\r\n\r\n    // Also...\r\n    // Put update same interest object in interestsSent array of User1\r\n\r\n    user1.interestsSent = user1.interestsSent.map((interest) => {\r\n      // First identify the interest object to be updated.\r\n      if (String(interest.interestReceiverId) === user2.id) {\r\n        interest.isAccepted = true;\r\n      }\r\n      return interest;\r\n    });\r\n\r\n    /**=============================================================== */\r\n    await user1.save();\r\n    await user2.save();\r\n\r\n    await session.commitTransaction();\r\n    session.endSession();\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Interest accepted!',\r\n    });\r\n  } catch (error) {\r\n    // If an error occurred, abort the whole transaction and\r\n    // undo any changes that might have happened\r\n    // console.log(error);\r\n    await session.abortTransaction();\r\n    session.endSession();\r\n    return next(new CustomErrorResponse('Error accepting interest. Please try later!', 500));\r\n  }\r\n});\r\n\r\n// @desc   Decline an Interest\r\n// @route  PUT /api/v1/interests/decline?sender=oktaUserId1&receiver=oktaUserId2\r\n// @access Private\r\n\r\n// Receiver of an interest can decline an interest.\r\n// User 1 is sender & User 2 is receiver.\r\n// So, update isRejected to \"true\" in interest object in interestsReceived array of User2\r\n// Also, update isRejected to \"true\" in interest object in interestsSent array of User1\r\nexports.declineInterest = asyncHandler(async (req, res, next) => {\r\n  const oktaUserId1 = req.query.sender;\r\n  const oktaUserId2 = req.query.receiver;\r\n  const session = await User.startSession();\r\n\r\n  try {\r\n    session.startTransaction();\r\n\r\n    const user1 = await User.find({ oktaUserId: oktaUserId1 })[0];\r\n    const user2 = await User.find({ oktaUserId: oktaUserId2 })[0];\r\n    /**=============================================================== */\r\n\r\n    user2.interestsReceived = user2.interestsReceived.map((interest) => {\r\n      // First identify the interest object which must be updated.\r\n      if (String(interest.interestSenderId) === user1.id) {\r\n        interest.isRejected = true;\r\n      }\r\n      return interest;\r\n    });\r\n\r\n    // Also...\r\n    // Put update same interest object in interestsSent array of User1\r\n\r\n    user1.interestsSent = user1.interestsSent.map((interest) => {\r\n      // First identify the interest object to be updated.\r\n      if (String(interest.interestReceiverId) === user2.id) {\r\n        interest.isRejected = true;\r\n      }\r\n      return interest;\r\n    });\r\n\r\n    /**=============================================================== */\r\n    await user1.save();\r\n    await user2.save();\r\n\r\n    await session.commitTransaction();\r\n    session.endSession();\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Interest rejected!',\r\n    });\r\n  } catch (error) {\r\n    // If an error occurred, abort the whole transaction and\r\n    // undo any changes that might have happened\r\n    // console.log(error);\r\n    await session.abortTransaction();\r\n    session.endSession();\r\n    return next(new CustomErrorResponse('Error rejecting interest. Please try later!', 500));\r\n  }\r\n});\r\n","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\n\r\n// @desc   Get Recommendations\r\n// @route  GET /api/v1/recommendations?oktaUserId=oktaUserId\r\n// @access Private\r\nexports.getRecommendations = asyncHandler(async (req, res, next) => {\r\n  try {\r\n    const currentUser = await User.find({ oktaUserId: req.params.oktaUserId });\r\n\r\n    if (!currentUser) {\r\n      return next(new CustomErrorResponse(`User not found!`, 404));\r\n    }\r\n\r\n    const currentUserGender = currentUser[0].gender;\r\n    const currentUserAge = currentUser[0].age;\r\n    const currentUserReligion = currentUser[0].religion;\r\n\r\n    const profiles = await User.find({ gender: { $ne: currentUserGender } }).exec();\r\n\r\n    //Recommendations based on gender, age and religion\r\n    const recommendations = profiles.filter((profile) => {\r\n      return (\r\n        (currentUserGender === 'male' ? profile.age <= currentUserAge : profile.age >= currentUserAge) &&\r\n        (currentUserReligion ? profile.religion === currentUserReligion : true)\r\n      );\r\n    });\r\n\r\n    console.log('No. of Recommendations: ', recommendations.length);\r\n\r\n    if (recommendations.length < 1) {\r\n      res.status(200).json({\r\n        success: false,\r\n        message: 'Recommendations not found. Please update your age and religion to get recommendations.',\r\n        number: recommendations.length,\r\n        data: recommendations,\r\n      });\r\n      return;\r\n    }\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Recommendations found.',\r\n      number: recommendations.length,\r\n      data: recommendations,\r\n    });\r\n  } catch (error) {\r\n    return next(new CustomErrorResponse('Error!. Please try later!', 500));\r\n  }\r\n});\r\n","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\n\r\nconst MINIMUM_HEIGHT_IN_CMS = 122;\r\nconst MAXIMUM_HEIGHT_IN_CMS = 214;\r\nconst MINIMUM_ALLOWED_AGE = 21;\r\nconst MAXIMUM_ALLOWED_AGE = 50;\r\n\r\n// @desc   Search Profiles\r\n// @route  POST /api/v1/users/search/:oktaUserId\r\n// @access Private\r\n\r\nexports.searchProfiles = asyncHandler(async (req, res, next) => {\r\n  try {\r\n    const currentUser = await User.find({ oktaUserId: req.params.oktaUserId });\r\n\r\n    if (!currentUser) {\r\n      return next(new CustomErrorResponse(`User not found!`, 404));\r\n    }\r\n\r\n    const currentUserGender = currentUser[0].gender;\r\n\r\n    const searchCriteria = req.body;\r\n    // Remove properties with 'undefined' & \"null\" values before perfmorming search in DB\r\n    Object.keys(searchCriteria).forEach((key) => {\r\n      if (searchCriteria[key] === undefined || searchCriteria[key] === null) {\r\n        delete searchCriteria[key];\r\n      }\r\n    });\r\n\r\n    const { ageRange, city, country, heightRange, religion, marriageStatus, motherTongue, state } = searchCriteria;\r\n\r\n    const minAge = ageRange === undefined ? MINIMUM_ALLOWED_AGE : ageRange[0];\r\n    const maxAge = ageRange === undefined ? MAXIMUM_ALLOWED_AGE : ageRange[1];\r\n    const minHeight = heightRange === undefined ? MINIMUM_HEIGHT_IN_CMS : heightRange[0];\r\n    const maxHeight = heightRange === undefined ? MAXIMUM_HEIGHT_IN_CMS : heightRange[1];\r\n\r\n    // get profiles of opposite gender.\r\n    const profiles = await User.find({ gender: { $ne: currentUserGender } }).exec();\r\n\r\n    // filter opposite gender profiles as per search preferences.\r\n    const matchingProfiles = profiles.filter((profile) => {\r\n      return (\r\n        profile.age >= minAge &&\r\n        profile.age <= maxAge &&\r\n        profile.height >= minHeight &&\r\n        profile.height <= maxHeight &&\r\n        (city ? profile.location === city : true) &&\r\n        (country ? profile.country === country : true) &&\r\n        (motherTongue ? profile.motherTongue === motherTongue : true) &&\r\n        (marriageStatus ? profile.marriageStatus === marriageStatus : true) &&\r\n        (religion ? profile.religion === religion : true) &&\r\n        (state ? profile.state === state : true)\r\n      );\r\n    });\r\n\r\n    console.log('No. of Matches: ', matchingProfiles.length);\r\n\r\n    if (matchingProfiles.length < 1) {\r\n      res.status(200).json({\r\n        success: false,\r\n        message: 'Matches not found. Please adjust your search criteria',\r\n        number: matchingProfiles.length,\r\n        data: matchingProfiles,\r\n      });\r\n      return;\r\n    }\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message: 'Matches found.',\r\n      number: matchingProfiles.length,\r\n      data: matchingProfiles,\r\n    });\r\n  } catch (error) {\r\n    return next(new CustomErrorResponse('Error!. Please try later!', 500));\r\n  }\r\n});\r\n","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\nconst okta = require('@okta/okta-sdk-nodejs');\r\n\r\n// @desc   Shortlist Profiles\r\n// @route  POST /api/v1/toggleShortlist?shortlister=oktaUserId1&shorlistee=oktaUserId2\r\n// @access Private\r\nexports.toggleShortlist = asyncHandler(async (req, res, next) => {\r\n  const shortlisterOktaId = req.query.shortlister;\r\n  const shortlisteeOktaId = req.query.shortlistee;\r\n\r\n  try {\r\n    // user who wants to shortlist\r\n    const shortlister = await User.find({ oktaUserId: shortlisterOktaId })[0];\r\n\r\n    // user who is being shortlisted\r\n    const shortlistee = await User.find({ oktaUserId: shortlisteeOktaId })[0];\r\n\r\n    // Did shortlister already shortlist shortlistee ?\r\n    const wasAlreadyShortlisted = shortlister.shortlistedMatches.some((oktaId) => oktaId === shortlisteeOktaId);\r\n\r\n    if (wasAlreadyShortlisted) {\r\n      // If Yes... then remove from shortlist\r\n      shortlister.shortlistedMatches = shortlister.shortlistedMatches.filter((oktaId) => oktaId !== shortlisteeOktaId);\r\n    } else {\r\n      // If No, then shortlist\r\n      shortlister.shortlistedMatches.push(shortlisteeOktaId);\r\n    }\r\n\r\n    await shortlister.save();\r\n\r\n    const message = wasAlreadyShortlisted\r\n      ? `${shortlistee.name} has been removed from your shortlist`\r\n      : `${shortlistee.name} was added to your shortlisted profiles`;\r\n\r\n    res.status(200).json({\r\n      success: true,\r\n      message,\r\n    });\r\n  } catch (error) {\r\n    return next(new CustomErrorResponse('Error!. Please try later!', 500));\r\n  }\r\n});\r\n","const asyncHandler = require('../middleware/async');\r\nconst User = require('../models/Users');\r\nconst CustomErrorResponse = require('../utilities/errorResponse');\r\nconst okta = require('@okta/okta-sdk-nodejs');\r\n\r\n// @desc   Register a new Profile\r\n// @route  POST /api/v1/users/\r\n// @access Public\r\n\r\nexports.registerUserProfile = asyncHandler(async (req, res, next) => {\r\n  // connect with okta here ?!\r\n  const user = await User.create(req.body);\r\n  res.status(201).json({ success: true, message: 'New user is created.', data: user });\r\n});\r\n/** ----------------------------------------- */\r\n\r\n//creating user inside mongodb with oktaInformation.\r\nconst createUserInMongoDB = async (mongoUser) => {\r\n  const user = await User.create(mongoUser);\r\n  return user;\r\n};\r\n\r\n//signing up user into okta\r\nexports.oktaSignUp = asyncHandler(async (req, res, next) => {\r\n  const client = new okta.Client({\r\n    orgUrl: 'https://dev-42684472.okta.com/',\r\n    token: '00TW3soK2Eq883PaRVu5rjqRniqE6iaueZOivSe91P',\r\n  });\r\n  const body = req.body;\r\n  try {\r\n    await createUserInOkta();\r\n    async function createUserInOkta() {\r\n      const response = await client.createUser(body);\r\n\r\n      //will update it with destructure\r\n      const oktaId = response.id;\r\n      const name = `${response.profile.firstName} ${response.profile.lastName}`;\r\n      const gender = response.profile.gender;\r\n      const email = response.profile.email;\r\n\r\n      const mongoUser = {\r\n        oktaUserId: oktaId,\r\n        name,\r\n        gender,\r\n        email,\r\n      };\r\n\r\n      await createUserInMongoDB(mongoUser);\r\n\r\n      res.send({\r\n        res: response,\r\n      });\r\n    }\r\n    await createUserInOkta();\r\n    // not using await will cause breakdown of express server\r\n    // whenever there is any error while trying to create user in Okta.\r\n  } catch (err) {\r\n    return next(new CustomErrorResponse(err, 404));\r\n    // res.send({\r\n    //   err: err,\r\n    // });\r\n  }\r\n});\r\n\r\n//find user in mongodb by oktaId\r\nasync function findUserByOktaId(oktaId) {\r\n  const currentUser = await User.find({ oktaUserId: oktaId });\r\n  // console.log(currentUser);\r\n  // console.log(currentUser[0]._id.toString());\r\n  return currentUser;\r\n}\r\n\r\n// @desc   Retrieve a user Profile\r\n// @route  GET /api/v1/users/:id\r\n// @access Private\r\nexports.getUserProfile = asyncHandler(async (req, res, next) => {\r\n  const params = req.params;\r\n  const oktaId = params.id;\r\n  const currentUser = await findUserByOktaId(oktaId);\r\n  if (!currentUser) {\r\n    return next(new CustomErrorResponse(`User not found!`, 404));\r\n  }\r\n  res.status(200).json({ currentUser });\r\n});\r\n\r\n//to upload image in mongodb\r\nexports.uploadImageToMongoDb = asyncHandler(async (req, res, next) => {\r\n  const imageUrl = req.body.imageUrlString;\r\n  const currentUserId = req.body.oktaUserId;\r\n  const currentUser = await findUserByOktaId(currentUserId);\r\n  // console.log(currentUser[0].images);\r\n  const imageUrls = currentUser[0].images;\r\n  if (!currentUser) {\r\n    return next(new CustomErrorResponse(`User not found!`, 404));\r\n  }\r\n  await User.updateOne({ oktaUserId: currentUserId }, { images: [...imageUrls, imageUrl] });\r\n  res.status(200).json({ status: 'success' });\r\n\r\n  // res.status(200).json({\r\n  //   success: true,\r\n  //   message: 'Retrieved User successfully',\r\n  //   user: user,\r\n  // });\r\n});\r\n\r\n/** ----------------------------------------- */\r\nexports.updateUserProfile = asyncHandler(async (req, res, next) => {\r\n  const currentUserId = req.params.userId;\r\n\r\n  //getting mongodbId using oktaUserId\r\n  // const user = await findUserByOktaId(currentUserId);\r\n  // const mongoId = user[0]._id.toString()\r\n  // console.log(mongoId);\r\n\r\n  if (!currentUserId) {\r\n    return next(new CustomErrorResponse(`Can't update data of non-existent user`, 400));\r\n  }\r\n  await User.updateOne({ oktaUserId: currentUserId }, { $set: req.body });\r\n  res.status(200).json({\r\n    success: true,\r\n    message: 'Updated User successfully',\r\n    data: 'user',\r\n  });\r\n});\r\n\r\n/** ----------------------------------------- */\r\n\r\n// @desc   Search Profiles\r\n// @route  GET /api/v1/users/search/\r\n// @access Private\r\n\r\nexports.searchProfiles = asyncHandler(async (req, res, next) => {\r\n  const searchCriteria = req.body;\r\n\r\n  // NOTE : WORK IN PROGRESS....\r\n\r\n  // Remove properties with 'undefined' values before perfmorming search in DB\r\n  Object.keys(searchCriteria).forEach((key) => {\r\n    if (searchCriteria[key] === undefined) {\r\n      delete searchCriteria[key];\r\n    }\r\n  });\r\n\r\n  let matchingProfiles = await User.find({ name: 'john', age: { $gte: 18 } }).exec();\r\n\r\n  // console.log(matchingProfiles);\r\n\r\n  if (matchingProfiles.length < 1) {\r\n    return next(new CustomErrorResponse(`Could not find matching profiles`, 400));\r\n  }\r\n\r\n  res.status(200).json({\r\n    success: true,\r\n    message: 'Updated User successfully',\r\n    data: matchingProfiles,\r\n  });\r\n});\r\n\r\n//for the admin part\r\n// exports.getAllUsersProfiles = asyncHandler(async (req, res, next) => {\r\n\r\n//   const allUsers = await User.find();\r\n\r\n//   res.status(200).json({ user: allUsers });\r\n// })\r\n","const asyncHandler = fn => (req, res, next) => {\r\n  Promise.resolve(fn(req, res, next)).catch(next);\r\n};\r\n\r\nmodule.exports = asyncHandler;\r\n\r\n// This asyncHanlder() will wrap around all controller methods which do DB operations...\r\n// If there is an error in DB Operation, asyncHandler() catches that error...\r\n// Then passes it to errorHandler() middleware...\r\n// Then the errorHandler middleware gives JSON as response.\r\n","// All Errors in this Express Application come here...\r\n// as errorHandler() is middleware function...\r\n// This helps send a customized response after identifying the error.\r\nconst ErrorResponse = require('../utilities/errorResponse');\r\nconst errorHandler = (err, req, res, next) => {\r\n  let error = { ...err };\r\n  error.message = err.message;\r\n\r\n  // Duplicate Phone/Email Used while Registration\r\n  if (err.code === 11000) {\r\n    const message = `Email / Phone already used for registration.`;\r\n    error = new ErrorResponse(message, 400); // 400 = bad request\r\n  }\r\n\r\n  if (err.code === \"E0000001\") {\r\n    const message = `password: This password was found in a list of commonly used passwords. Please try another password.`;\r\n    error = new ErrorResponse(message, 400); // 400 = bad request\r\n  }\r\n\r\n  // Mongoose validation error\r\n  if (err.name === 'ValidationError') {\r\n    const message = Object.values(err.errors).map((val) => val.message);\r\n    console.log(message);\r\n    error = new ErrorResponse(message.join(' & '), 400);\r\n  }\r\n\r\n  res.status(error.statusCode || 500).json({\r\n    success: false,\r\n    error: error.message || 'Server Error',\r\n  });\r\n};\r\n\r\nmodule.exports = errorHandler;\r\n","const mongoose = require('mongoose');\r\n\r\nconst MessageSchema = new mongoose.Schema({\r\n  messageSenderId: {\r\n    type: mongoose.SchemaTypes.ObjectId,\r\n    trim: true,\r\n  },\r\n  messageReceiverId: {\r\n    type: mongoose.SchemaTypes.ObjectId,\r\n    trim: true,\r\n  },\r\n  message: {\r\n    type: String,\r\n    trim: true,\r\n    maxlength: [500, 'Message can not be more than 500 characters'],\r\n  },\r\n  isRead: {\r\n    type: Boolean,\r\n    default: false,\r\n  },\r\n  timeStamp: {\r\n    type: Date,\r\n    default: Date.now,\r\n  },\r\n});\r\n\r\nconst UserSchema = new mongoose.Schema({\r\n  name: {\r\n    type: String,\r\n    trim: true,\r\n    required: [true, 'Name is missing!'],\r\n    maxlength: [50, 'Name can not be more than 50 characters'],\r\n  },\r\n  gender: {\r\n    type: String,\r\n    required: [true, 'Gender is missing!'],\r\n    trim: true,\r\n  },\r\n  email: {\r\n    type: String,\r\n    required: [true, 'Email is missing!'],\r\n    unique: true,\r\n    match: [/^\\w+([\\.-]?\\w+)*@\\w+([\\.-]?\\w+)*(\\.\\w{2,3})+$/, 'Please add a valid email'],\r\n  },\r\n  oktaUserId: {\r\n    type: String,\r\n    unique: true,\r\n    required: [true, 'Okta User Id is missing !'],\r\n  },\r\n  images: {\r\n    type: [String],\r\n    default: [],\r\n  },\r\n\r\n  // Personal Information\r\n\r\n  aboutMe: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  age: {\r\n    type: Number,\r\n    trim: true,\r\n    default: 21,\r\n  },\r\n  height: {\r\n    type: Number,\r\n    trim: true,\r\n    default: 140,\r\n  },\r\n  weight: {\r\n    type: Number,\r\n    trim: true,\r\n  },\r\n  physique: {\r\n    type: String,\r\n    default: '',\r\n    trim: true,\r\n  },\r\n  motherTongue: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  marriageStatus: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  citizenship: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  country: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  state: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  location: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  eatingHabits: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  smokingHabits: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  drinkingHabits: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  hobbies: {\r\n    type: [String],\r\n    default: [],\r\n  },\r\n  spokenLanguages: {\r\n    type: [String],\r\n    default: [],\r\n  },\r\n\r\n  // Education & Occupation Details\r\n\r\n  employer: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  income: {\r\n    type: Number,\r\n  },\r\n  occupation: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  qualification: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n\r\n  // Family Details\r\n\r\n  aboutFamily: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  brothers: {\r\n    type: Number,\r\n  },\r\n  familyStatus: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  marriedBrothers: {\r\n    type: Number,\r\n  },\r\n  marriedSisters: {\r\n    type: Number,\r\n  },\r\n  sisters: {\r\n    type: Number,\r\n  },\r\n\r\n  // Religious Details\r\n\r\n  dateOfBirth: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  timeOfBirth: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  gothram: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  placeOfBirth: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  religion: {\r\n    type: String,\r\n    trim: true,\r\n  },\r\n\r\n  zodiacSign: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n\r\n  // Preference Details\r\n\r\n  partnerAgeRange: {\r\n    type: [Number],\r\n    default: [21, 50],\r\n  },\r\n  partnerCountry: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n  partnerEatingHabits: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  partnerHeightRange: {\r\n    type: [Number],\r\n    default: [],\r\n  },\r\n  partnerIncomeRange: {\r\n    type: [Number],\r\n    default: [],\r\n  },\r\n  partnerMaritalStatus: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  partnerMotherTongue: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n  partnerReligion: {\r\n    type: String,\r\n    trim: true,\r\n    default: '',\r\n  },\r\n\r\n  phone: {\r\n    type: String,\r\n    default: '',\r\n    trim: true,\r\n    maxlength: [20, 'Phone number can not be longer than 20 characters'],\r\n  },\r\n  createdAt: {\r\n    type: Date,\r\n    default: Date.now(),\r\n  },\r\n  lastModifiedAt: {\r\n    type: Date,\r\n    default: Date.now,\r\n  },\r\n  role: {\r\n    type: String,\r\n    default: 'User',\r\n    enum: ['User', 'Admin'],\r\n  },\r\n\r\n  //store mongoDB Ids of all shortlisted users.\r\n  shortlistedMatches: {\r\n    type: [mongoose.SchemaTypes.ObjectId],\r\n    default: [],\r\n  },\r\n\r\n  // for each interest received... a unique object is created.\r\n  // Subsequent messages \"to & from\" the sender are stored in conversations array inside the object.\r\n  interestsReceived: [\r\n    {\r\n      interestSenderAge: { type: Number },\r\n      interestSenderId: { type: mongoose.SchemaTypes.ObjectId },\r\n      interestSenderImage: { type: String },\r\n      interestSenderName: { type: String },\r\n      interestReceiverAge: { type: Number },\r\n      interestReceiverId: { type: mongoose.SchemaTypes.ObjectId },\r\n      interestReceiverImage: { type: String },\r\n      interestReceiverName: { type: String },\r\n      isAccepted: { type: Boolean, default: false },\r\n      isRejected: { type: Boolean, default: false },\r\n      conversations: [MessageSchema],\r\n    },\r\n  ],\r\n\r\n  // for each interest sent... a unique object is created...\r\n  // Subsequent messages \"to & from\" the receiver are stored in conversations array inside the object\r\n  interestsSent: [\r\n    {\r\n      interestSenderAge: { type: Number },\r\n      interestSenderId: { type: mongoose.SchemaTypes.ObjectId },\r\n      interestSenderImage: { type: String },\r\n      interestSenderName: { type: String },\r\n      interestReceiverAge: { type: Number },\r\n      interestReceiverId: { type: mongoose.SchemaTypes.ObjectId },\r\n      interestReceiverImage: { type: String },\r\n      interestReceiverName: { type: String },\r\n      isAccepted: { type: Boolean, default: false },\r\n      isRejected: { type: Boolean, default: false },\r\n      conversations: [MessageSchema],\r\n    },\r\n  ],\r\n});\r\n\r\nmodule.exports = mongoose.model('User', UserSchema);\r\n","const express = require('express');\r\n\r\n//importing controllers\r\nconst {\r\n  getAllUsersProfiles\r\n} = require('../controllers/admin');\r\n\r\nconst router = express.Router();\r\n\r\n//getting all users of pesto-matrimony\r\nrouter.route('/getallusers').get(getAllUsersProfiles)\r\n\r\n\r\nmodule.exports = router;\r\n","const express = require('express');\r\nconst { getMessages, sendMessage, markMessagesAsRead } = require('../controllers/conversations');\r\n\r\nconst router = express.Router();\r\n\r\n// '/' in this router is equivalent to  '/api/v1/conversations'\r\n\r\n// A message is an object in conversations array.\r\n// All of these controller functions are working on that conversations array.\r\nrouter.route('/').post(sendMessage).put(markMessagesAsRead);\r\n\r\nrouter.route('/:userId').get(getMessages);\r\n\r\nmodule.exports = router;\r\n","const express = require('express');\r\nconst { acceptInterest, declineInterest, sendInterest } = require('../controllers/interests');\r\n\r\nconst router = express.Router();\r\n\r\n// '/' in this router is equivalent to  '/api/v1/interests'\r\n\r\nrouter.route('/').post(sendInterest);\r\n\r\nrouter.route('/accept').put(acceptInterest);\r\n\r\nrouter.route('/decline').put(declineInterest);\r\n\r\nmodule.exports = router;\r\n","const express = require('express');\r\nconst router = express.Router();\r\n\r\nconst { getRecommendations } = require('../controllers/recommendations');\r\n\r\n// '/' in this router is equivalent to  '/api/v1/recommendations'\r\n\r\nrouter.route('/').get(getRecommendations);\r\n\r\nmodule.exports = router;\r\n","const express = require('express');\r\nconst router = express.Router();\r\n\r\nconst { searchProfiles } = require('../controllers/search');\r\n\r\n// '/' in this router is equivalent to  '/api/v1/search'\r\n\r\nrouter.route('/').post(searchProfiles);\r\n\r\nmodule.exports = router;\r\n","const express = require('express');\r\nconst router = express.Router();\r\n\r\nconst { toggleShortlist } = require('../controllers/shortlist');\r\n\r\n// '/' in this router is equivalent to  '/api/v1/toggleShortlist'\r\n\r\nrouter.route('/').put(toggleShortlist);\r\n\r\nmodule.exports = router;\r\n","const express = require('express');\r\n\r\n\r\nconst { getUserProfile, uploadImageToMongoDb, updateUserProfile, oktaSignUp, searchProfiles } = require('../controllers/users');\r\n\r\nconst router = express.Router();\r\n\r\n// '/' in this router is equivalent to  '/api/v1/users'\r\n\r\n// Signup\r\nrouter.route('/oktasignup').post(oktaSignUp);\r\nrouter.route('/userprofile/:id').get(getUserProfile);\r\nrouter.route('/imageupload/:id').post(uploadImageToMongoDb);\r\n\r\n//it was running for the admin\r\n// router.route('/getallusers').get(getAllUsersProfiles)\r\n\r\n// Update / Delete\r\nrouter.route('/:userId').get(getUserProfile).put(updateUserProfile);\r\n\r\n// Fetch User Profiles\r\nrouter.route('/search').get(searchProfiles);\r\n\r\n// Have to create another route & controller function for...\r\n// handling search and filters with pagination..\r\n// This route will have a lot of complex logic.\r\n\r\n// updateUserProfile will only be used to update Profile details...\r\n// NOT messages... although it is possible...\r\n// For message flow... a separate route (conversations) is present\r\n// Update\r\nrouter.route('/:userId').put(updateUserProfile);\r\n\r\nmodule.exports = router;\r\n","class CustomErrorResponse extends Error {\r\n  constructor(message, statusCode) {\r\n    super(message);\r\n    this.statusCode = statusCode;\r\n  }\r\n}\r\n\r\nmodule.exports = CustomErrorResponse;\r\n","module.exports = require(\"@okta/okta-sdk-nodejs\");","module.exports = require(\"body-parser\");","module.exports = require(\"cors\");","module.exports = require(\"express\");","module.exports = require(\"mongoose\");","module.exports = require(\"tslib\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const cors = require('cors');\r\nconst express = require('express');\r\nconst dbConnection = require('./config/database');\r\nconst errorHandler = require('./middleware/error');\r\nconst bodyParser = require('body-parser');\r\n\r\n// Connect to MongoDB\r\ndbConnection();\r\n\r\n// Start Express Server\r\nconst app = express();\r\n\r\napp.use(cors());\r\n\r\napp.use(express.json());\r\n\r\n// parse application/x-www-form-urlencoded\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\n// parse application/json\r\napp.use(bodyParser.json());\r\n\r\n// importing routes\r\nconst conversations = require('./routes/conversations.js');\r\nconst admin = require('./routes/admin.js');\r\nconst interests = require('./routes/interests.js');\r\nconst recommendations = require('./routes/recommendations.js');\r\nconst search = require('./routes/search.js');\r\nconst toggleShortlist = require('./routes/shortlist.js');\r\nconst users = require('./routes/users.js');\r\n\r\n// mounting routes\r\napp.use('/api/v1/conversations', conversations);\r\napp.use('/api/v1/admin', admin);\r\napp.use('/api/v1/interests', interests);\r\napp.use('/api/v1/recommendations', recommendations);\r\napp.use('/api/v1/search', search);\r\napp.use('/api/v1/toggleShortlist', toggleShortlist);\r\napp.use('/api/v1/users', users);\r\n\r\n// error Handler\r\napp.use(errorHandler);\r\n\r\nconsole.log(process.env.PORT)\r\n\r\nconst server = app.listen(\r\n  process.env.PORT || 8000,\r\n  console.log(`Server is listening on port : ${process.env.PORT || 8000}\\nMode: ${process.env.NODE_ENV.toUpperCase()}`)\r\n);\r\n\r\n// Error in connecting to MongoDB triggers unhandledRejection at global level\r\n// That is being handled here. This stops server if MongoDB is NOT connected.\r\nprocess.on('unhandledRejection', (err, promise) => {\r\n  console.log(`Error: ${err.message}`);\r\n  server.close(() => process.exit(1));\r\n});\r\n"],"names":["mongoose","module","exports","console","log","connect","process","env","MONGO_URI","useNewUrlParser","useUnifiedTopology","asyncHandler","User","getAllUsersProfiles","req","res","next","allUsers","find","status","json","user","CustomErrorResponse","sendMessage","oktaUserId1","query","sender","oktaUserId2","receiver","message","_id","Types","ObjectId","body","messageSenderId","messageReceiverId","isRead","session","startSession","startTransaction","user1","oktaUserId","user2","didUser1SendInterestToUser2","interestsSent","some","interest","String","interestReceiverId","didUser1ReceiveInterestFromUser2","interestsReceived","interestSenderId","map","conversations","push","save","commitTransaction","endSession","success","error","abortTransaction","markMessagesAsRead","findById","id","getMessages","userId","params","sendInterest","name","interestSenderAge","age","interestSenderImage","images","interestSenderName","interestReceiverAge","interestReceiverImage","interestReceiverName","isAccepted","isRejected","acceptInterest","declineInterest","getRecommendations","currentUser","currentUserGender","gender","currentUserAge","currentUserReligion","religion","recommendations","$ne","exec","filter","profile","length","number","data","searchProfiles","searchCriteria","Object","keys","forEach","key","undefined","minAge","ageRange","maxAge","minHeight","heightRange","maxHeight","matchingProfiles","height","city","location","country","motherTongue","marriageStatus","state","toggleShortlist","shortlisterOktaId","shortlister","shortlisteeOktaId","shortlistee","wasAlreadyShortlisted","shortlistedMatches","oktaId","okta","registerUserProfile","create","findUserByOktaId","oktaSignUp","client","Client","orgUrl","token","createUserInOkta","response","createUser","mongoUser","firstName","lastName","email","createUserInMongoDB","send","err","getUserProfile","uploadImageToMongoDb","imageUrl","imageUrlString","currentUserId","imageUrls","updateOne","updateUserProfile","$set","$gte","fn","Promise","resolve","catch","ErrorResponse","code","values","errors","val","join","statusCode","MessageSchema","Schema","type","SchemaTypes","trim","maxlength","Boolean","default","timeStamp","Date","now","UserSchema","required","unique","match","aboutMe","Number","weight","physique","citizenship","eatingHabits","smokingHabits","drinkingHabits","hobbies","spokenLanguages","employer","income","occupation","qualification","aboutFamily","brothers","familyStatus","marriedBrothers","marriedSisters","sisters","dateOfBirth","timeOfBirth","gothram","placeOfBirth","zodiacSign","partnerAgeRange","partnerCountry","partnerEatingHabits","partnerHeightRange","partnerIncomeRange","partnerMaritalStatus","partnerMotherTongue","partnerReligion","phone","createdAt","lastModifiedAt","role","enum","model","express","router","Router","route","get","post","put","Error","constructor","super","this","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","cors","dbConnection","errorHandler","bodyParser","app","use","urlencoded","extended","admin","interests","search","users","PORT","server","listen","toUpperCase","on","promise","close","exit"],"sourceRoot":""}